<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Route</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // Add timeout to detect if Google Maps fails to load
        let mapLoadTimeout;
        window.initMap = function() {
            clearTimeout(mapLoadTimeout);
            if (window.actualInitMap) window.actualInitMap();
        };
        
        // Set a timeout to show error if Maps API doesn't load within 10 seconds
        mapLoadTimeout = setTimeout(() => {
            const loadingEl = document.getElementById('mapLoading');
            if (loadingEl) {
                loadingEl.innerHTML = `
                    <div style="color: #d32f2f; text-align: center;">
                        <p>Unable to load Google Maps</p>
                        <button onclick="location.reload()" style="
                            padding: 10px 20px;
                            background: #4CAF50;
                            color: white;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 14px;
                        ">Retry</button>
                    </div>
                `;
            }
        }, 10000);
    </script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap"
        async
        defer
        onerror="document.getElementById('mapLoading').innerHTML='<p style=\'color: #d32f2f; text-align: center;\'>Failed to load Google Maps. <button onclick=\'location.reload()\' style=\'padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;\'>Retry</button></p>';">
    </script>
</head>
<body>
    <button id="burgerBtn" class="burger-btn" aria-label="Open menu" aria-expanded="false" aria-controls="sideMenu">
        Alternative {% if service_type == 'vet' %}Vets{% else %}Hospitals{% endif %}
    </button>

    <div id="menuOverlay" class="menu-overlay" tabindex="-1" aria-hidden="true"></div>

    <aside id="sideMenu" class="side-menu" aria-hidden="true">
        <button id="closeMenu" class="close-menu" aria-label="Close menu">&times;</button>
        <div class="side-content">
            <div id="alternativeHospitalsContainer">
                <!-- Alternative hospitals will be loaded here dynamically -->
                <p style="text-align: center; color: var(--muted); padding: 20px;">Loading alternative {% if service_type == 'vet' %}vets{% else %}hospitals{% endif %}...</p>
            </div>
        </div>
    </aside>

    <div class="map-container">
        <div id="currentHospitalBanner" class="current-hospital-banner">
            <div class="hospital-info">
                <span class="hospital-name">Loading...</span>
                <span class="hospital-details"></span>
            </div>
        </div>
        <button id="trafficToggle" class="traffic-toggle" onclick="toggleTraffic()" aria-label="Toggle traffic overlay">
            ðŸš¦ Traffic Overlay: <span id="trafficStatus">OFF</span>
        </button>
        <div id="lastUpdated" class="last-updated">Last updated just now</div>
        <div id="mapLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
            <p style="text-align: center; color: #666;">Loading map...</p>
        </div>
        <div id="map" style="flex: 1; width: 100%;"></div>

        <div class="map-actions">
            <button class="action-button taxi-button" onclick="openUber()">
                Call an Uber
            </button>
            <button class="action-button navigate-button" onclick="openGoogleMaps()">
                Get there with Google Maps
            </button>
            {% if service_type == 'vet' %}
            <button class="action-button emergency-button" onclick="callRSPCA()">
                Call RSPCA
            </button>
            {% else %}
            <button class="action-button emergency-button" onclick="call999()">
                Call 999
            </button>
            {% endif %}
        </div>
    </div>
s
    <script>window.MAP_PLACE = {{ request.args.get('place', '')|tojson }};</script>
    <script>window.SERVICE_TYPE = {{ service_type|tojson }};</script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>